# This is a basic workflow to help you get started with Actions

name: Nuget-CI-CD

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ mercurial-zstd ]
  #   branches: [ master ]
  # pull_request:
  #   branches: [ master ]

# Cancel any workflow jobs running if the PR is re-triggered
concurrency:
  group: ci-${{ github.head_ref }}-group
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
      with:
        fetch-depth: 0
    - name: Set Beta Version
      if: github.event_name != 'push'
      run: echo "release-suffix=-beta" >> $GITHUB_ENV
    - name: Set Release Version
      if: github.event_name == 'push'
      run: echo "release-suffix=." >> $GITHUB_ENV

    - name: Nuget pack
      run: dotnet msbuild -target:Build build/SIL.Chorus.Mercurial.proj -property:PreRelease=${{ env.release-suffix }} -property:BuildCounter=${{ github.run_number }}

    - name: Upload Artifacts
      uses: actions/upload-artifact@1746f4ab65b179e0ea60a494b83293b640dd5bba # v4.3.2
      with:
        name: packages
        path: ./**/*.nupkg
        if-no-files-found: error
